---
title: "SSCProject2"
author: "Elizabeth Pauley"
date: "11/2/2022"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

Load packages
```{r}
library(tidyverse)
library(countrycode)  
library(lubridate)   
library(WDI)
```


Read in data and clean
```{r}
refugees_raw <- read_csv("refugee_status.csv", na = c("-", "X", "D"))

non_countries <- c("Africa", "Asia", "Europe", "North America", "Oceania",
                   "South America", "Unknown", "Other", "Total")

refugees_clean <- refugees_raw %>%
  # Make this column name easier to work with
  rename(origin_country = `Continent/Country of Nationality`) %>%
  # Get rid of non-countries
  filter(!(origin_country %in% non_countries)) %>%
  # Convert country names to ISO3 codes
  mutate(iso3 = countrycode(origin_country, "country.name", "iso3c",
                            custom_match = c("Korea, North" = "PRK"))) %>%
  # Convert ISO3 codes to country names, regions, and continents
  mutate(origin_country = countrycode(iso3, "iso3c", "country.name"),
         origin_region = countrycode(iso3, "iso3c", "region"),
         origin_continent = countrycode(iso3, "iso3c", "continent")) %>%
  # Make this data tidy
  gather(year, number, -origin_country, -iso3, -origin_region, -origin_continent) %>%
  # Make sure the year column is numeric + make an actual date column for years
  mutate(year = as.numeric(year),
         year_date = ymd(paste0(year, "-01-01")))
```


```{r}
refugees_countries_cumulative <- refugees_clean %>%
  arrange(year_date) %>%
  group_by(origin_country) %>%
  mutate(cumulative_total = cumsum(number))

refugees_continents <- refugees_clean %>%
  group_by(origin_continent, year_date) %>%
  summarise(total = sum(number, na.rm = TRUE))

refugees_clean <- refugees_raw %>%
  rename(origin_country = `Continent/Country of Nationality`) %>%
  dplyr::filter(!(origin_country %in% non_countries)) %>%
  mutate(iso2 = countrycode(origin_country, "country.name", "iso2c",
                            custom_match = c("Korea, North" = "KP"))) %>%
  mutate(origin_country = countrycode(iso2, "iso2c", "country.name"),
         origin_region = countrycode(iso2, "iso2c", "region"),
         origin_continent = countrycode(iso2, "iso2c", "continent")) %>%
  gather(year, number, -origin_country, -iso2, -origin_region, -origin_continent) %>%
  mutate(year = as.numeric(year),
         year_date = ymd(paste0(year, "-01-01")),
         iso2c = iso2)

library(WDI)
myData = WDI(country = refugees_clean$iso2, indicator = 'SP.POP.TOTL', start = 2006, end = 2015)  %>%
      dplyr::select(-country)

refugees_clean_merged = left_join(refugees_clean, myData, by = c('iso2c','year')) 

head(refugees_clean_merged %>% dplyr::select(origin_country, number, iso2, year, SP.POP.TOTL))

```



Exploratory analysis- all countries
```{r}
refugees_clean %>%
  ggplot(aes(year, number, group = origin_country)) +
  geom_line(aes(color = origin_country), show.legend = TRUE)
```

Lets group by origin continent
```{r}
ref_cont <- refugees_clean %>% 
  group_by(origin_continent,year) %>%
  summarise(total = sum(number, na.rm=TRUE))

ref_cont %>%
  ggplot(aes(year, total, group = origin_continent)) +
  geom_line(aes(color = origin_continent), show.legend = TRUE, size=2)+
    geom_point(size = 2)
```


Lets group by origin continent
```{r}
ref_origin <- refugees_clean %>% 
  group_by(origin_region,year) %>%
  summarise(total = sum(number, na.rm=TRUE))

ref_origin %>%
  ggplot(aes(year, total, group = origin_region)) +
  geom_line(aes(color = origin_region), show.legend = TRUE, size=2)+
    geom_point(size = 2)
```




```{r}
ref_cum <- refugees_countries_cumulative %>% 
  group_by(origin_region,year) %>%
  summarise(totalcum = sum(number, na.rm=TRUE))
ref_cum
```


Per capita calculations
```{r}
refugees_percap <- refugees_clean_merged %>%
  arrange(year_date) %>%
  group_by(origin_country) %>%
  mutate(percap = number/SP.POP.TOTL)
```


```{r}
ref_cap_origin <- refugees_percap %>% 
  group_by(origin_region,year) %>%
  summarise(totalcap = sum(percap, na.rm=TRUE))

ref_cap_origin %>%
  ggplot(aes(year, totalcap, group = origin_region)) +
  geom_line(aes(color = origin_region), show.legend = TRUE, size=2)+
    geom_point(size = 2)
```


```{r}
ref_cap_country <- refugees_percap %>% 
  group_by(origin_country,year, origin_region) %>%
  summarise(totalcap = sum(percap, na.rm=TRUE))
unique(ref_cap_country$origin_country)
```

Top 10 countries with refugees in 2010:
https://www.migrationpolicy.org/article/refugees-and-asylees-united-states-2021#:~:text=Refugees%20from%20Myanmar%20were%20the,13%20percent%20(77%2C400%20refugees). 

1. Iraq
2. Myanmar (Burma)
3. Bhutan
4. Somalia
5. Cuba
6. Iran
7. Congo (Congo - Brazzaville) and (Congo - Kinshasa)
8. Eritrea
9. Palestine
10. Vietnam

Countries with US conflict:
1. Afghanistan
2. Syria
3. Myanmar
4. Pakistan
5. Iraq

```{r}
top_countries=ref_cap_country %>% filter(origin_country%in% c("Iraq", "Myanmar (Burma)", "Liberia", "Moldova", "Eritrea", "Somalia"))
```

```{r}
top_countries %>%
  ggplot(aes(year, totalcap, group = origin_country)) +
  geom_line(aes(color = origin_country), show.legend = TRUE)+
    geom_point()
```





```{r}
sa_data=refugees_clean %>% filter(origin_region=="South Asia" )

sa_data %>%
  ggplot(aes(year, number, group = origin_country)) +
  geom_line(aes(color = origin_country), show.legend = TRUE, size=2)+
    geom_point(size = 2)
```




```{r}
eu_data=refugees_clean %>% filter(origin_region=="Europe & Central Asia" )

eu_data %>%
  ggplot(aes(year,number, group = origin_country)) +
  geom_line(aes(color = origin_country), show.legend = TRUE, size=2)+
    geom_point(size = 2)
```



```{r}
na_data=refugees_clean %>% filter(origin_region=="Latin America & Caribbean" )

na_data %>%
  ggplot(aes(year, number, group = origin_country)) +
  geom_line(aes(color = origin_country), show.legend = TRUE, size=2)+
    geom_point(size = 2)
```


```{r}
ssafrica_data=refugees_clean %>% filter(origin_region=="Sub-Saharan Africa" )

ssafrica_data %>%
  ggplot(aes(year, number, group = origin_country)) +
  geom_line(aes(color = origin_country), show.legend = TRUE, size=2)+
    geom_point(size = 2)
```

```{r}
meafrica_data=refugees_clean %>% filter(origin_region=="Middle East & North Africa" )

meafrica_data %>%
  ggplot(aes(year, number, group = origin_country)) +
  geom_line(aes(color = origin_country), show.legend = TRUE, size=2)+
    geom_point(size = 2)
```


```{r}
easia_data=refugees_clean %>% filter(origin_region=="East Asia & Pacific" )

easia_data %>%
  ggplot(aes(year, number, group = origin_country)) +
  geom_line(aes(color = origin_country), show.legend = TRUE, size=2)+
    geom_point(size = 2)
```

```{r}
top_countries_region=ref_cap_country %>% filter(origin_country%in% c("Iraq", "Myanmar (Burma)", "Somalia", "Russia", "Cuba", "Bhutan"))
```

```{r}
top_countries_region %>%
  ggplot(aes(year, totalcap, group = origin_country)) +
  geom_line(aes(color = origin_country), show.legend = TRUE)+
    geom_point()
```

```{r}

top_countries_region2=refugees_countries_cumulative %>% filter(origin_country%in% c("Iraq", "Myanmar (Burma)", "Somalia", "Russia", "Cuba", "Bhutan"))

color_blind_friendly_cols <-
  c("#D55E00","#F0E442", "#0072B2", "#009E73", "#999999", "#CC79A7")

x = ggplot(data = top_countries_region2, aes(year, number, group = origin_country)) +
  geom_line(aes(color = origin_country), show.legend = TRUE,size=1.25)+
    geom_point()+scale_x_continuous(breaks = scales::pretty_breaks(n = 12)) 

x + scale_color_manual(values=color_blind_friendly_cols) +theme_bw() + labs(x="Year", y= "Number of refugees", title="Number of refugees from 2006 to 2015") +
  theme(legend.position = "right") + theme(legend.key.size = unit(0.5, 'cm')) + 
  theme(legend.text = element_text(size=8)) + theme(legend.title = element_text(size=12))+
  theme(legend.background = element_rect(colour = 'black', fill = 'white', linetype='solid')) +
  guides(color = guide_legend(title="Origin Country")) +
  theme(axis.text=element_text(size=10),axis.title=element_text(size=10,face="bold")) +
  theme(plot.title = element_text(face="bold")) 

```



